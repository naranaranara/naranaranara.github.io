---
layout: post
title:  "Variational Method"
toc: true          # 우측 목차
toc_sticky: true   # 스크롤해도 고정
date: 2025-10-31
tags: [markdown, blog]
use_math: true
mathjax: true
---
# Variational Method(변분법)
Consider the following integral: 1차원 탄성 에너지  

$$
I(u) := \int_{\Omega} \frac{1}{2} \underbrace{EA}_{\text{Modulus}} (\underbrace{u_{,x}}_{\text{Strain}})^2 dx
$$  

증명: y축이 응력 ($\sigma$)고 x축이 변형률 ($\epsilon$)이면 선형적으로 증가하는 그래프이다. 따라서 그래프의 아래 면적은 단위부피당 에너지 밀도이고 $dV=Adx$ 이므로 적분해주면 위의 식이 나옴.  

<br>

$$
\Pi[u] := \int_{\Omega} \frac{1}{2} \underbrace{EA(u_{,x})^2}_{\text{strain E}} dx - \int_{\Omega} \underbrace{f \cdot u A}_{\text{force}} dx - \underbrace{t A \cdot u(L)}_{\text{force, traction}}
$$  

여기서의 $\Pi[u]$는 깁스의 free energy, 포텐셜 에너지와 같음.  

$\Pi[u]$는 함수가 아니고 범함수다.  
! 함수: 숫자를 넣으면 숫자가 나온다.  
! 범함수: 함수를 넣으면 숫자가 나온다.  
<br>
<img width="264" height="131" alt="스크린샷 2025-11-10 144529" src="https://github.com/user-attachments/assets/7c243db5-f511-42c0-98ac-3e47da8ebcf7" />  

Consider a variation  
$w$ such that the varied field  
$ u_{\epsilon}$ : 테스트용 해, $w$: 가상의 변화 방향 , $\epsilon$: 아주 작은 변화량  
$ u_{\epsilon} := u + \epsilon w $  
w는 디리클레 경계조건에서 0일 때 0 이다. 따라서 $u_{\epsilon}$은 디리클레 경계조건을 따른다.  
<br>
## 범함수 $\Pi[u]$
$\frac{d}{d\epsilon} \Pi[u_{\epsilon}]$ :$u$가 변할 때 $\Pi$는 얼마나 변하는지 - 변화의 형태($w$)를 골랐으므로 $\Pi$는 $\epsilon$의 간단한 함수가 된다.  
$\frac{d}{d\epsilon} \Pi[u_{\epsilon}] \Big|_{\epsilon=0}$ : $\epsilon$을 0으로 보낼 때(즉 다시 원래 위치 u로 돌아올 때)의 기울기가 0이어야 한다.( $u$가 최소점이라면 0+,0-로 조금 건드려도 0이여야 한다)  
<br>
Find $u\in S$ such that $\forall w \in V$  
$ S = \{ u \in L^2 \mid u(0) = u_0 \}, \quad V = \{ w \in L^2 \mid w(0) = 0 \}$  
<br>  

$$ 
\begin{align*}
 & \frac{d}{d\epsilon} \Pi[u_{\epsilon}] \Big|_{\epsilon=0} = 0 \\
\Rightarrow \quad & \frac{d}{d\epsilon} \left[ \int_{\Omega} \frac{1}{2} EA((u+\epsilon w)_{,x})^2 dx - \int_{\Omega} f \cdot (u+\epsilon w)A dx - tA \cdot (u+\epsilon w) \right] \Bigg|_{\epsilon=0} = 0 \\
\Rightarrow \quad & \left[ \int_{\Omega} \frac{1}{2} EA \cdot 2 (u+\epsilon w)_{,x} w_{,x} dx - \int_{\Omega} f \cdot w A dx - tAw \right] \Bigg|_{\epsilon=0} = 0 \\
\Rightarrow \quad & \int_{\Omega} EA u_{,x} w_{,x} dx - \int_{\Omega} f \cdot w A dx - tAw(L) = 0 \\
\Rightarrow \quad & \int_{\Omega} w_{,x} \underbrace{EA u_{,x}}_{\sigma} dx - \int_{\Omega} w \cdot f A dx - w(L) \cdot tA = 0 \\
\Rightarrow \quad & \int_{\Omega} w_{,x} \sigma A dx - \int_{\Omega} w f A dx - w(L) t A = 0
\end{align*}
$$  

weak form이랑 형식이 같다.  
<br>
극값원리가 가능할 때 변분법으로 weak form을 얻을 수 있다. 열전달이나 물질확산에는 적합하지 않다.  
변분 원리가 존재하는 예: 정상 상태의 탄성 문제, 정상 상태의 슈뢰딩거 방정식.  
## 3차원 열전달 문제 풀기
<img width="237" height="108" alt="image" src="https://github.com/user-attachments/assets/3c8f4c03-6008-43a7-892c-9898bd236229" />  
$ {e_i} , i=1,2,3$ 각 축은 서로 수직이다.  
<br>
### strong form
Find u, given $f(\vec{x}), u_g, j_n$ 그리고 constitutive relation $ j_i=-k_{ij} u_{,j}$ (i,j = 1,2,3)  

such that $-J_{i,i}=f$ in $\Omega$ (에너지 보존법칙)  

B.C.s:  
$u = u_g \text{ on } \partial\Omega_u$ (디리클레 경계조건)  
$-J \cdot n = j_n \text{ on } \partial\Omega_j$ (노이만 경계조건)
<br>  
!!뭐가 뭔지 정리!!  

 $j_i=- k_{ij} u_{,j}$ : 푸리에 열전도 방정식
 $u_{,j}$: 온도구배, 공간으로 얼마나 가파르게 변하는지  
 $k_{ij}$ : 열전도도  
 $-J_{i,i}=f$ : 미소부피에서 빠져나가는 열의 양 = 부피 안에서 생성되는 열의 양  
 $f$: 열원(heat source)  
 $j_i$: 열흐름(heat flux)  
 디리클레 경계조건: 경계의 특정 부분에서 온도값이 고정되는 조건 (ex. 얼음물에 계속 담구면 0도로 고정)  
 노이만 경계조건: 열의 흐름의 양이 정해지는 조건 (ex. 단열)
 
 ### weak form  
 
 Step 1. 강형의 지배 방정식 : $-j_{i,i}=f$  
 
 Step 2. 잔차 만들기: $R=-j_{i,i]-f=0$  
 
 Step 3. 가중함수 곱하기: $wxR=w(-j_{i,i]-f)=0$  
 
 Step 4. 적분 : $\int_{\Omega} w \cdot R \, dV = \int_{\Omega} w(-J_{i,i} - f) = 0$ , $\int_{\Omega} -w J_{i,i} \, dV = \int_{\Omega} w f \, dV$  
 <br>  
 
 $$
 \underbrace{\int_{\Omega} -w J_{i,i} dV}_{\text{integrate by parts (Product rule \& divergence theorem)}} = \int_{\Omega} w f dV
 $$  
 <br> 
 
강형에서 약형으로 가보자!  

$$
\begin{align*}
& \int_{\Omega} \left( -(\underbrace{w J_i}_{\text{Vector}})_{,i} + w_{,i} J_i \right) dV = \int_{\Omega} w f dV \quad \text{Product rule} \\
\\
& -\int_{\partial\Omega} w J_i n_i dS + \int_{\Omega} w_{,i} J_i dV = \int_{\Omega} w f dV \quad \text{Divergence theorem} \\
\\
\Rightarrow \quad & \int_{\Omega} w_{,i} J_i dV = \int_{\Omega} w f dV + \underbrace{\int_{\partial\Omega_u} w J_i n_i dS}_{=0} + \int_{\partial\Omega_j} w \underbrace{J_i n_i}_{-j_n} dS \\
\\
\Rightarrow \quad & \int_{\Omega} w_{,i} J_i dV = \int_{\Omega} w f dV - \int_{\partial\Omega_j} w j_n dS
\end{align*}
$$  
<br>  
!! Divergence Theorem 과 Product rule 정리  
1 \. 발산정리  
내부의 총 변호량은 경계면을 통해 나간 총량과 같다.  
2 \. 곱의 법칙  
흔히 아는 적그그미  

## 3차원 서브도메인  

<img width="454" height="103" alt="스크린샷 2025-11-10 161706" src="https://github.com/user-attachments/assets/a0424337-140a-40dd-be84-09a2b7c10aee" />  

**consider trilinear basis fuctions**  

<img width="375" height="84" alt="스크린샷 2025-11-10 161835" src="https://github.com/user-attachments/assets/ca6107f7-9e5b-4462-9ea3-ca02861dc88f" />  

$$
u_e^h = \sum_{A=1}^{n_{\text{nel}}=8} N^A(\xi) d_e^A, \quad w_e^h = \sum_{A=1}^{n_{\text{nel}}=8} N^A(\xi) c_e^A
$$

2차원이랑 마찬가지로 $\Omega^e$는 $\Omega^{\xi}$에서 매핑해서 얻어진다.  
<img width="573" height="193" alt="스크린샷 2025-11-10 162231" src="https://github.com/user-attachments/assets/3dcfecc2-f89b-49fb-9819-305848d2b073" />  
<br>
$$
\begin{array}{rcl}
    N^1(\xi, \eta, \zeta) & = & \frac{1}{8}(1-\xi)(1-\eta)(1-\zeta) \\
    N^2(\xi, \eta, \zeta) & = & \frac{1}{8}(1+\xi)(1-\eta)(1-\zeta) \\
    N^3(\xi, \eta, \zeta) & = & \frac{1}{8}(1+\xi)(1+\eta)(1-\zeta) \\
    N^4(\xi, \eta, \zeta) & = & \frac{1}{8}(1-\xi)(1+\eta)(1-\zeta) \\
    N^5(\xi, \eta, \zeta) & = & \frac{1}{8}(1-\xi)(1-\eta)(1+\zeta) \\
    N^6(\xi, \eta, \zeta) & = & \frac{1}{8}(1+\xi)(1-\eta)(1+\zeta) \\
    N^7(\xi, \eta, \zeta) & = & \frac{1}{8}(1+\xi)(1+\eta)(1+\zeta) \\
    N^8(\xi, \eta, \zeta) & = & \frac{1}{8}(1-\xi)(1+\eta)(1+\zeta)
  \end{array}
  $$  
  
  위의 수식들은 3차원에서의 basis fuction이고 모두 크로네커 델타 함수의 조건을 만족한다.  

다시 약형으로 돌아와서  
$ \int_{\Omega} w^h_{,i} J^h_i ,dV = \int_{\Omega} w^h f ,dV - \int_{\partial\Omega_S} w^h \bar{t}_n ,dS$  

매핑하는 방법을 보면 
$$
x_i(\underline{\xi}) = \sum_{A=1}^{n_{ne}} N^A(\underline{\xi}) x_{ei}^A
$$  
$$
\frac{\partial x_i}{\partial \xi_I} = \sum_{A=1}^{n_{ne}} N^A_{,I} x_{ei}^A
$$  

**The gradient of the map - "tangent map"**  

자코비안 : $\underline{J} := \frac{\partial \underline{x}}{\partial \underline{\xi}}$
자코비안은 매핑할 때 det(J)로 쓰이면서 이 근방에서 부피가 몇 배로 스케일 되는지 말해줌
<br>

**The integrals in finite-dimensional weak form**

$$
\begin{align*}
\int_{\Omega^e} w^h_{,i} J^h_i \, dV &= -\int_{\Omega^e} w^h_{,i} K_{ij} u^h_{,j} \, dV = -\int_{\Omega^e} \underbrace{\left(\sum_{A=1}^{n_{ne}} N^A_{,i} c_e^A\right)}_{w^h_{,i}} K_{ij} \underbrace{\left(\sum_{B=1}^{n_{ne}} N^B_{,j} d_e^B\right)}_{u^h_{,j}} \, dV \\
&= -\int_{\Omega^e} \left(\sum_{A=1} N^A_{,I} \xi_{I,i} c_e^A\right) K_{ij} \left(\sum_B N^B_{,J} \xi_{J,j} d_e^B\right) \, dV \\
&= -\sum_{A,B} c_e^A \left(\int_{\Omega^e} N^A_{,I} \xi_{I,i} K_{ij} N^B_{,J} \xi_{J,j} \, dV\right) d_e^B
\end{align*}
$$  

(밑에 첨자가 헷갈릴 수 있음. $x_{i}$ 소문자 i 이고 $\xi_{I}$ 대문자 I임) 체인룰을 사용해서 식을 변형했다.  
<br>  

**Complete change of variables to $\xi$**  

전에도 설명했듯이 det(J)는 부피가 몇 배로 스케일 됐는지 말해준다.  
따라서 $ dV = \det(\underline{J}(\underline{\xi}))dV^{\xi}$ 이렇게 바꿔쓸 수 있다.  
<br>  
**Integral in finite-dimensional weak form** 
<br>

$$
\begin{align*}
\int_{\Omega^e} w^h_{,i} j^h_i \,dV &= -\sum_{A,B} c_e^A \left( \int_{\Omega^e} N^A_{,I} \xi_{I,i} K_{ij} N^B_{,J} \xi_{J,j} \det[\underline{J}(\underline{\xi})] \,dV^\xi \right) d_e^B \quad \rightarrow K_{ij}(\underline{x}(\underline{\xi})) \\
&= -\sum_{A,B} c_e^A \left( \int_{-1}^{1}\int_{-1}^{1}\int_{-1}^{1} N^A_{,I} \xi_{I,i} K_{ij} N^B_{,J} \xi_{J,j} \det[\underline{J}(\underline{\xi})] \,d\xi_1 d\xi_2 d\xi_3 \right) d_e^B \\
&= -\sum_{A,B} c_e^A K_e^{AB} d_e^B
\end{align*}
$$  
위의 식이 최종식이 된다.  

**2차원에서의 라그랑지안**  

<img width="271" height="106" alt="스크린샷 2025-11-11 092752" src="https://github.com/user-attachments/assets/10a24e23-bd14-4042-be96-3b16503f26b0" />  
도메인 $\Omega$를 2차원의 서브도메인으로 나눈다고 생각해보자. 이 경우에도 동일하게 서브도메인의 좌표는 -1부터 1로 한다.  
(0,0)을 원점으로 두고 2차원 서브도메인의 좌표는 2차원이기 때문에 4점이 있고 각각 (1,1),(-1,1),(-1,-1),(1,-1)이다.  
형상함수는 크로네커 델타 함수를 만족시켜야 하기 때문에  

$$
\begin{align*}
N^1(\xi, \eta) &= \frac{1}{4} (1-\xi) (1-\eta) \\
N^2(\xi, \eta) &= \frac{1}{4} (1+\xi) (1-\eta) \\
N^3(\xi, \eta) &= \frac{1}{4} (1+\xi) (1+\eta) \\
N^4(\xi, \eta) &= \frac{1}{4} (1-\xi) (1+\eta)
\end{align*}
$$  

<img width="260" height="155" alt="image" src="https://github.com/user-attachments/assets/e1e3aff3-8385-4781-8be7-52250f2e2e58" />  
## A Unified of basis fuction in 1-3D
**1차원**  

1\. 1차식의 형상함수  

$$
\begin{align*}
\tilde{N}^1(\xi_1) &= \frac{1-\xi_1}{2} \\
\tilde{N}^2(\xi_1) &= \frac{1+\xi_1}{2}
\end{align*}
$$  

2.\. 2차식의 형상함수  

&&
\begin{align*}
\tilde{N}^1(\xi_1) &= -\frac{(1-\xi_1)\xi_1}{2} \\
\tilde{N}^2(\xi_1) &= 1-\xi_1^2 \\
\tilde{N}^3(\xi_1) &= \frac{(1+\xi_1)\xi_1}{2}
\end{align*}
$$  
**2차원**  
<img width="247" height="122" alt="image" src="https://github.com/user-attachments/assets/66541f4a-7407-448a-bb11-d279b6f44407" />  
고차원에서는  

$$
N^A(\xi_1) = \prod_{\substack{B=1 \\ B \neq A}}^{n_{n1D}} \frac{\xi_1 - \xi_1^B}{\xi_1^A - \xi_1^B}
$$  

2차원은 1차 다항식 두개를 곱해서 형상함수를 만들 수 있다.  
A 점을 기준으로 보면 A는 $\xi_1$방향과 $\xi_2$ 방향으로 A점에서 1이 되는 형상함수 두개가 있다. 이 둘을 곱해서 형상함수를 만든다.  

모든 점에서 적용해서 식을 써보면  
$$
\begin{align*}
N^1(\xi_1, \xi_2) &= \tilde{N}^1(\xi_1) \tilde{N}^1(\xi_2) \\
N^2(\xi_1, \xi_2) &= \tilde{N}^2(\xi_1) \tilde{N}^2(\xi_2) \\
&\vdots \\
N^4(\xi_1, \xi_2) &= \tilde{N}^1(\xi_1) \tilde{N}^2(\xi_2)
\end{align*}
$$  

**3차원**
<img width="317" height="249" alt="image" src="https://github.com/user-attachments/assets/61340e55-1d74-474c-9d52-aa1146459fbf" />  

3차원에서도 2차원에서와 방법은 똑같은데 좌표축이 3개가 있어서 3개에 대해서 다 해줘야한다.  
예로 5번 노드를 보자. $\xi_1$ 방향으로는 두번째 노드, $\xi_2$ 방향으로는 첫번째 노드, $\xi_3$ 방향으로는 첫번째 노드이다.  
$$
N^5(\xi_1, \xi_2, \xi_3) = \tilde{N}^2(\xi_1) \cdot \tilde{N}^1(\xi_2) \tilde{N}^1(\xi_3)
$$

## Numericla integration in 1-3D(수치적분)  

$\int_{-1}^{1} g(\xi) d\xi \approx \sum_{e=1}^{n_{\text{int}}} g(\xi^{(e)}) w_e$
원래는 -1부터 1까지 $g(\xi_1)$을 계산해야하는데 몇개의 적분점과 가정치의 곱의 합으로 나타낸다는 것이다.  
여기서 $w_e$는 그 점이 차지하는 넓이의 비중(가중치)이다.  

가우스 적분: $n_int$포인트로 $2n_{int}-1$차항까지 해를 정확히 맞출 수 있다.  

$$
\begin{align*}
& n_{\text{int}} = 1 & \xi_1^e &= 0, & w_e &= 2 \\
& \vdots & & & & \\
& n_{\text{int}} = 3 & \xi_1^1 &= -\sqrt{\frac{3}{5}}, & w_1 &= \frac{5}{9} \\
& & \xi_1^2 &= 0, & w_2 &= \frac{8}{9} \\
& & \xi_1^3 &= \sqrt{\frac{3}{5}}, & w_3 &= \frac{5}{9}
\end{align*}
$$  
!증명!  
$\int_{-1}^{1} g(\xi) \,d\xi \approx w_1 g(\xi^{(1)}) + w_2 g(\xi^{(2)}) + w_3 g(\xi^{(3)})$  
이렇게 표현할 수 있고 가우스 적분은 $2n_{int}-1$차항까지 정확히 맞출 수 있으므로 5차까지 나타낼 수 있다.  
세점은 대칭으로 $-a,0,+a$로 뽑는다. 가중치도 각각 $w_1,w_2,w_3$으로 한다.  

**0차 상수일 때**
진짜 적분 : $\int_{-1}^{1} 1 \,d\xi = 2$  
가우스 : $w_1 \cdot 1 + w_0 \cdot 1 + w_3 \cdot 1 = w + w_0 + w = w_0 + 2w$  
따라서 $w_0 + 2w = 2$  

**1차 함수일 때**
진짜 적분: $\int_{-1}^{1} \xi \,d\xi = 0$  
가우스 : $w_1(-a) + w_0(0) + w_3(+a) = w(-a) + w(a) = 0$  
따라서 그냥 잘 맞는다.  

**2차 함수일 때**  
진짜 적분: 
$$
\int_{-1}^{1} \xi^2 \,d\xi = \left[ \frac{\xi^3}{3} \right]_{-1}^{1} = \frac{1}{3} - \left(-\frac{1}{3}\right) = \frac{2}{3}
$$  
가우스: $w_1(-a)^2 + w_0(0)^2 + w_3(a)^2 = wa^2 + 0 + wa^2 = 2wa^2$  
따라서 $2wa^2 = \frac{2}{3} \Rightarrow wa^2 = \frac{1}{3}$  

**3차 함수일 때**  

대칭이여서 둘다 0이 나온다.  

**4차 함수일 떄**  
진짜 적분:  

&&
\int_{-1}^{1} \xi^4 \,d\xi = \left[ \frac{\xi^5}{5} \right]_{-1}^{1} = \frac{1}{5} - \left(-\frac{1}{5}\right) = \frac{2}{5}
$$  
가우스: $w_1(-a)^4 + w_0(0)^4 + w_3(a)^4 = wa^4 + 0 + wa^4 = 2wa^4$  
따라서 $2wa^4 = \frac{2}{5} \Rightarrow wa^4 = \frac{1}{5}$  

모든 식을 정리하면 결과가 나온다.  

2차함수일 때도 성립한다.  
진짜 적분 : $\int_{-1}^{1} \int_{-1}^{1} g(\xi_1, \xi_2) \,d\xi_1 \,d\xi_2$  
수치 적분: 
$$
\int_{-1}^{1} \left( \sum_{l_1=1}^{n_{\text{int}}} g(\xi_1^{l_1}, \xi_2) W_{l_1} \right) \,d\xi_2  
= \sum_{l_2=1}^{n_{\text{int}}} \sum_{l_1=1}^{n_{\text{int}}} g(\xi_1^{l_1}, \xi_2^{l_2}) W_{l_1} W_{l_2}
$$
여기서도 $w_1,w_2$가 각각 2이고 함은 4이다. 그리고 사각형 아랫면의 넓이는 4이다.  






 




