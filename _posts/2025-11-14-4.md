---
layout: post
title:  "FEM 시리즈 #4"
toc: true          # 우측 목차
toc_sticky: true   # 스크롤해도 고정
date: 2025-11-14
tags: [markdown, blog]
use_math: true
mathjax: true
---
# 선형 형상함수 
\* simplex elements 란?  
simplex는 삼각형 사면체를 일반화한 가장 단순한 도형이라는 뜻이다. 1차원에서는 선분, 2차원에서는 삼각형, 3차원에서는 사면체이다.  
FEM 에서 말하는 simplex elements란 기준 영역이 이런 simplex 모양인 요소들을 통틀어 말한다. 장점은 아무리 찌그러져도 삼각형이나 사면체로 쪼개기가 쉽다. 즉 메시 생성에 유리하다. 또한 형상 함수의 정의가 단순하다. (그냥 다 더하면 1이다가 정의)  
  
1\. 2차원에서 삼각형 요소 

<img width="460" height="115" alt="image" src="https://github.com/user-attachments/assets/65c4d22d-f71f-4df3-bb22-645592092a83" />{: .centered }   

세 점을 더했을 때 1이 된다.  
$\xi_3 = 1 - \xi_1 - \xi_2$  

<img width="231" height="147" alt="image" src="https://github.com/user-attachments/assets/fb85662a-8943-4616-8754-e94e6c4a0856" />{: .centered }   

$$
\begin{align*}
 N^1(\xi_1, \xi_2, \xi_3) &= \xi_1 \\
 N^2(\xi_1, \xi_2, \xi_3) &= \xi_2 \\
 N^3(\xi_1, \xi_2, \xi_3) &= \xi_3
\end{align*}  
$$  

2\. 3차원에서는 사면체  

<img width="412" height="124" alt="image" src="https://github.com/user-attachments/assets/5025f797-bc86-4152-81a2-888c7a6d62df" />{: .centered }   

2차원에서와 똑같이 더했을 때 1이 되어야 한다.  
$\xi_4 = 1 - \xi_1 - \xi_2 - \xi_3$  

$$
\begin{align*}
 N^1(\xi_1, \xi_2, \xi_3, \xi_4) &= \xi_1 \\
 \vdots \\
 N^4(\xi_1, \xi_2, \xi_3, \xi_4) &= \xi_4
\end{align*}
$$  

$\underline{Remark}$ : 선형 형상 함수는 미분하면 상수가 나온다. 그래서 응력이나 변형률이 모두 일정하게 나온다. 따라서 휘어지거나 응력 집중을 표현할 수 없다. 이를 해결하려면 한 요소 안의 형상함수 차수를 올리는 방법을 사용하거나 요소를 잘게 쪼개야 한다.  

## 2차원 선형 정상상태 미분 방정식  
예로 열확산 문제를 풀어보자  

given $u_g, j_n,f$, the constitutive relation $ j_i = -K_{ij}u_{,j}$ i,j는 2차원이기 때문에 각각 1,2 값을 갖는다.  

<img width="242" height="97" alt="image" src="https://github.com/user-attachments/assets/3aca531e-d972-4c12-8841-a2adb664768f" />{: .centered }   

**Strong form**  

Find $u$ such that $-j_{i,i} = f \quad \text{in } \Omega \subset \mathbb{R}^2$  
with b.c.s:  
$u = u_g \quad \text{on } \partial\Omega_w$ 디리클레 경계조건  
$-j_i n_i = \bar{j}_n \quad \text{on } \partial\Omega_j$ 노이만 경계조건  

**Weak form**  

Find $u^h \in S^h \subset S \quad \text{; } S^h = \{ u^h \in H^1(\Omega) \mid u^h=u_g \text{ on } \partial\Omega_u \}$  
such that $\forall w^h \in V^h \subset V \quad \text{; } V^h = \{ w^h \in H^1(\Omega) \mid w^h=0 \text{ on } \partial\Omega_u \}$  

$$
+\int_{\Omega} w^h_{,i} \underbrace{j_i^h}_{+K_{ij}u^h_{,j}} dA = \int_{\Omega} w^h \bar{f} dA + \int_{\partial\Omega_j} w^h \bar{j}_n dS \quad \text{; } i,j=1,2
$$  

$w^h$와 $u^h$를 구하기 위해서 형상함수를 정의해야 한다.  

\-사각형으로 정의  

<img width="334" height="111" alt="image" src="https://github.com/user-attachments/assets/3b2e3f79-a1d7-4f67-890a-863f1bbd4b83" />{: .centered }   

\- 삼각형으로 정의

<img width="408" height="140" alt="image" src="https://github.com/user-attachments/assets/1ff97a63-840d-4526-ab22-f443e81231f6" />{: .centered } 

형상 함수의 식은  
Bilinear Lagrange polynomial: $N^A(\xi_1, \xi_2) \quad , \quad A=1, \cdots, n_{ne} (=4)$  
Linear polynomial: $N^A(\xi_1, \xi_2, \underset{\substack{\downarrow \\ 1-\xi_1-\xi_2}}{\xi_3}) \quad , \quad A=1, \cdots, n_{ne} (=3)$  

또한 $u_e^h$와 $w_e^h$는 다음과 같이 정의한다.  

$$
u_e^h = \sum_{A=1}^{n_{ne}} N^A \hat{d}_e^A \quad , \quad w_e^h = \sum_{A=1}^{n_{ne}} N^A \hat{c}_e^A
$$  

Gradients:  

$$
u_{,I}^h = \sum_{A=1}^{n_{ne}} \underbrace{N^A_{,\xi_1} \frac{\partial \xi_1}{\partial x_I} + N^A_{,\xi_2} \frac{\partial \xi_2}{\partial x_I}}_{\text{Rewrite } N^A(\xi_1, \xi_2, \xi_3) \text{ using } \xi_3=1-\xi_1-\xi_2 \text{ for triangles.}} \quad , \quad I=1,2
$$  

앞에서 한 것과 같이 

$$
\begin{align*}
 x_{ie}(\xi_1, \xi_2) &= \sum_A N^A x_{ie}^A \\
 \Rightarrow \frac{\partial x_i}{\partial \xi_I} &= \sum_A N^A_{,\xi_I} x_{ie}^A \quad i=1,2, \quad I=1,2
\end{align*}```
$$

**두 번째 이미지:**

$$
\underline{J}(\underline{\xi}) = 
\begin{bmatrix} 
\frac{\partial x_1}{\partial \xi_1} & \frac{\partial x_1}{\partial \xi_2} \\
\frac{\partial x_2}{\partial \xi_1} & \frac{\partial x_2}{\partial \xi_2} 
\end{bmatrix} 
\Rightarrow \underline{J}^{-1}(\underline{\xi}) = 
\begin{bmatrix} 
\frac{\partial \xi_1}{\partial x_1} & \frac{\partial \xi_1}{\partial x_2} \\
\frac{\partial \xi_2}{\partial x_1} & \frac{\partial \xi_2}{\partial x_2} 
\end{bmatrix}
$$  

위의 식을 이용해서 weak form의 각 요소들을 구해보면

$$
u_{,i}^h = \sum_A \frac{\partial N^A}{\partial \xi_I} \frac{\partial \xi_I}{\partial x_i} \hat{d}_e^A
$$

1\. $-\int_{\Omega} w_{,i}^h j_i^h dA = -\sum_e \int_{\Omega^e} w_{,i}^h j_i^h dA$  

$dA$를 $d\xi_1, d\xi_2$와 자코비안의 곱으로 표현해서 식정리 하면  

$$
-\int_{\Omega^e} w_{,i}^h \underset{\uparrow}{j_i^h} dA = -\sum_{A,B=1}^{n_{ne}} \hat{c}_e^A \underbrace{\left( \int_{-1}^1 \int_{-1}^1 N^A_{,i} (-K_{ij}) N^B_{,j} \det(\underline{J}(\underline{\xi})) d\xi_1 d\xi_2 \right)}_{\bar{K}_e^{AB}} \hat{d}_e^B \quad i,j=1,2
$$

2\. $\int_{\Omega} w^h \bar{f} dA = \sum_e \int_{\Omega^e} w^h \bar{f} dA$

$dA$를 $d\xi_1, d\xi_2$와 자코비안의 곱으로 표현해서 식정리 하면  

$$
\int_{\Omega^e} w^h \bar{f} dA = \sum_A \hat{c}_e^A \underbrace{\left( \int_{-1}^1 \int_{-1}^1 N^A \bar{f} \det(\underline{J}) d\xi_1 d\xi_2 \right)}_{\bar{F}_e^{\text{int}A}}
$$

3\. $$
\int_{\partial\Omega_j} w^h \bar{j}_n ds = \sum_{e \in E_{\Gamma N}} \int_{\partial\Omega_j^e} w^h j_n ds
$$
$A_N$은 노이만 경계조건에 해당하는 경계 노드이다. 노이만 경계조건은 표면에 수직으로 빠져나가는 부분이므로 경계 노드에만 해당한다.
$$
\int_{\partial\Omega_j^e} w^h j_n ds = \sum_{A \in E_{AN}} c_e^A \underbrace{\int_{\partial\Omega_j^e} N^A j_n \det(\underline{J}_s) d\xi_1}_{F_e^{j_n A}}
$$

따라서 $Kd=F$꼴이 된다.

## 3차원 선형 정상상태 미분 방정식(coordinate notaion ver.)

<img width="225" height="176" alt="image" src="https://github.com/user-attachments/assets/43ce79e8-bce1-4c38-8d7f-ee198bd9610a" />{: .centered } 

$$
\underbrace{u_i^g, \bar{t}_i, f_i}_{\text{coordinate notation}} \quad (\underbrace{\underline{u}^g, \underline{\bar{t}}, \underline{\bar{f}}}_{\text{direct notation}} \in \mathbb{R}^3)
$$  

구성방정식은  
$$
\underbrace{\sigma_{ij}}_{\substack{\text{(Stress)} \\ \text{(Cauchy)}}} = \underbrace{C_{ijkl}}_{\substack{\text{4th order tensor} \\ \text{elasticity tensor}}} \underbrace{\varepsilon_{kl}}_{\substack{\text{strain} \\ \text{infinitesimal} \\ \text{(극미한 변형)}}}
$$  

위의 coordinate notation을 direct notation으로 바꿔서 쓰면  
$\underline{\sigma} = \underline{\underline{C}} : \underline{\underline{\varepsilon}}$  

변형률은 
$$
\varepsilon_{kl} = \frac{1}{2} \left( \frac{\partial u_k}{\partial x_l} + \frac{\partial u_l}{\partial x_k} \right), \quad (\underline{\underline{\varepsilon}} = \text{sym} \, \nabla \underline{u})
$$  

find $u_i \quad (\underline{u} \in \mathbb{R}^3)$ such that  
$\sigma_{ij,j} + f_i = 0 \quad \text{in } \Omega_j$ 응력평형 발산식  

경계조건:  
$$
\begin{align*}
u_i &= u_i^g \quad \text{on } \partial\Omega_{u_i} \\
\sigma_{ij} n_j &= \bar{t}_i \quad \text{on } \partial\Omega_{\bar{t}_i}
\end{align*}
$$  

## 3차원 선형 정상상태 미분 방정식 (direct notaion ver.)  

$$
u_i^g, \bar{t}_i, \underline{f}, \quad \underline{\sigma} = \underline{\underline{C}} : \underline{\underline{\varepsilon}}, \quad \underline{\underline{\varepsilon}} = \text{sym}(\nabla \underline{u})
$$  

find $\underline{u}$ such that  
$$
\begin{align*}
 \nabla \cdot \underline{\sigma} + \underline{f} &= 0 \quad \text{in } \Omega \\
 u_i &= u_i^g \quad \text{on } \partial\Omega_{u_i} \\
 (\underline{\sigma} \underline{n})_i &= \bar{t}_i \quad \text{on } \partial\Omega_{\bar{t}_i}
\end{align*}
$$  

구성방정식:  
$\sigma_{ij} = C_{ijkl} \varepsilon_{kl}$  

## C 행렬의 특징  
1\. minor symmetry (쌍 내부에서의 대칭성)  

ij는 응력 쪽 인덱스, kl은 변형률 쪽 인덱스 인데 응력과 변형률 둘 다 대칭이니까 각 쌍 안에서 순서 바꿔도 값이 동일하다.  

2\. major symmetry (쌍 끼리 통째로 바꾸는 대칭성)  

응력은 대칭이므로  
$\sigma_{ij} = C_{ijkl} \varepsilon_{kl} = \sigma_{ji} = C_{jikl} \varepsilon_{kl}$  
따라서 $C_{ijkl} = C_{jikl}$이다.  

3\. positive definite  
말 그대로 모두 양수라는 뜻이다.  

단위 체적당 탄성 에너지 밀도는 
$$
W(\boldsymbol{\varepsilon}) = \frac{1}{2} \boldsymbol{\varepsilon} : \mathbf{C} : \boldsymbol{\varepsilon}
$$

따라서 양이 되려면 어떤 변형률을 줘도 저장 에너지는 항상 양수임을 뜻한다.  

1차원으로 단순화하면 $ \sigma = E\varepsilon, \quad W = \frac{1}{2} E\varepsilon^2$ 이다.  
여기서 $E>0$이 같은 의미다.  

4\. $C$는 등방성 재료를 나타낸다.  
**Coordinate notation**: $C_{ijke} = \lambda \delta_{ij} \delta_{ke} + 2\mu \cdot \frac{1}{2}(\delta_{ik}\delta_{jl} + \delta_{il}\delta_{jk})$  

$ \lambda \delta_{ij} \delta_{ke}$: 수직 변형(부피)  
$\frac{1}{2}(\delta_{ik}\delta_{jl} + \delta_{il}\delta_{jk})$  : 전단(모양)  

$$
\mathbb{I}_{ijke} \theta_{ke} = \frac{1}{2}(\theta_{ij} + \theta_{ji})
$$ 
크로네카 델타 함수는 인덱스가 같으면 1이므로 $kl$ 은 1이 되어서 없어지고 $ij$만 남게 된다.  

**Direct notation** : $\mathbb{C} = \lambda \underline{1} \otimes \underline{1} + 2\mu \underline{\underline{\mathbb{I}}}$  

$\lambda, \mu$: Lamei constants  
$ E$: young's modulus (재료가 얼마나 딱딱한지)  
$ \nu$: Poisson ratio (한쪽으로 당겼을 때 수직방향으로 얼마나 얇아지는지)  
$K$: Bulk modulus (모든 방향에서 힘을 가했을 때 부피가 얼마나 줄어들지 안혹 버티는지; 체적탄성계수)   

$\lambda = \frac{E\nu}{(1+\nu)(1-2\nu)}$ ; $\mu = \frac{E}{2(1+\nu)}$  
$K = \frac{E}{3(1-2\nu)}$  
(분모는 0이 되면 안되니까 $-1 \le \nu \le \frac{1}{2}$)  

**Strong form을 Weak form으로**(coordinate notation ver.)  

given $$
u_i^g, \bar{t}_i, f_i$ , the constitutive relation $\bar{\sigma}_{ij} = \mathbb{C}_{ijkl} \varepsilon_{kl}
$$, the kinematic relation $$
\varepsilon_{kl} = \frac{1}{2} \left( \frac{\partial u_k}{\partial x_l} + \frac{\partial u_l}{\partial x_k} \right)
$$  

find $u_i \in S = \{ u_i \mid u_i = u_i^g \text{ on } \partial\Omega_{u_i} \}, \quad i=1,2,3$  
such that $\int_{\Omega} w_{i,j} \sigma_{ij} \,dV = \int_{\Omega} w_i f_i \,dV + \sum_{i=1}^{n_{sd}} \int_{\partial\Omega_{t_i}} w_i \bar{t}_i \,dS$  

$\int_{\Omega} w_{i,j} \sigma_{ij} \,dV = \int_{\Omega} w_i f_i \,dV + \sum_{i=1}^{n_{sd}} \int_{\partial\Omega_{t_i}} w_i \bar{t}_i \,dS$  

Strong form 양변에 $w_i$를 곱하고 $\Omega$에 대하여 적분한다.  

$\int_{\Omega} w_i \sigma_{ij,j} \,dV + \int_{\Omega} w_i f_i \,dV = 0$  
$\sigma_{ij,j}$ 이 부분을 integrate by parts (Product rule + Divergence theroem)  

$$
\int_{\Omega} (w_i \sigma_{ij})_{,j} \,dV - \int_{\Omega} w_{i,j} \sigma_{ij} \,dV + \int_{\Omega} w_i f_i \,dV = 0
$$  
$$
W_i \sigma_{ij,j} = (W_i \sigma_{ij})_{,j} - W_{i,j} \sigma_{ij}
$$ 이 식을 $(w_i \sigma_{ij})_{,j}$ 여기에 넣어서 식정리 한거임  

Divergence rule을 사용하면  
$\int_{\partial\Omega} w_i \sigma_{ij} n_j \,dS - \int_{\Omega} w_{i,j} \sigma_{ij} \,dV + \int_{\Omega} w_i f_i \,dV = 0$
첫번째 적분을 우변으로 옮기고 노이만 경계조건을 사용하면  

$\partial\Omega = \partial\Omega_{u_i} \cup \partial\Omega_{t_i}$ 3차원이여서 i,j는 각각 1,2,3 값을 가진다.  

$\int_{\Omega} w_{i,j} \sigma_{ij} \,dV = \int_{\Omega} w_i f_i \,dV + \sum_{i=1}^{n_{sd}} \left( \int_{\partial\Omega_{u_i}} w_i (\sigma_{ij} n_j) \,dS + \int_{\partial\Omega_{t_i}} w_i (\sigma_{ij} n_j) \,dS \right)$  

summation 안에 있는 디리클레 경계 안에 $ w_i (\sigma_{ij} n_j)$ 값은 0이 된다.  
또한 노이만 경계에 있는  $\sigma_{ij} n_j$값은 $t_i$가 된다.  

$\int_{\Omega} w_{i,j} \sigma_{ij} \,dV = \int_{\Omega} w_i f_i \,dV + \sum_{i=1}^{n_{sd}} \int_{\partial\Omega_{t_i}} w_i \bar{t}_i \,dS$  

여기까지 구한 weak form은 무한 차원의 weak form이었고, 컴퓨터는 유한개의 수만 다룰 수 있기 때문에 부분 공간 ($V^h$)에서의 근사해 ($u^h$)를 찾는다.  

**The finite dimensional weak form**:  

given $$
u_i^g, \bar{t}_i, f_i
$$, the constitutive relation $$
\bar{\sigma}_{ij} = \mathbb{C}_{ijkl} \varepsilon_{kl}
$$  
and the kinematic relation 
$$
\varepsilon_{kl} = \frac{1}{2} \left( \frac{\partial u_k}{\partial x_l} + \frac{\partial u_l}{\partial x_k} \right)
$$    

find $u_i^{h} \in S^h \subset S \quad ; \quad S^h = \{ u_i^h \in H^1(\Omega) \mid u_i^h = u_i^g \text{ on } \partial\Omega_{u_i} \}$  
such that $\forall w_i^h \in V^h \subset V \quad ; \quad V^h = \{ w_i^h \in H^1(\Omega) \mid w_i^h = 0 \text{ on } \partial\Omega_{u_i} \}$   

$$
\int_{\Omega} w_{i,j}^h \sigma_{ij}^h \,dV = \int_{\Omega} w_i^h f_i \,dV + \sum_{i=1}^{n_{sd}} \int_{\partial\Omega_{t_i}} w_i^h \bar{t}_i \,dS 
$$  

유한 공간에서의 형상함수  

















