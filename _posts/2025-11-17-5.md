---
layout: post
title:  "FEM 시리즈 #5"
toc: true          # 우측 목차
toc_sticky: true   # 스크롤해도 고정
date: 2025-11-17
tags: [markdown, blog]
use_math: true
mathjax: true
---
## Linear parabolic pde in a scalar variable in 3D  

예. 비정상 상태의 열전도, 물질 확산 in 3D  

**Strong form**  

<img width="311" height="140" alt="image" src="https://github.com/user-attachments/assets/20f60263-9a4b-421d-ab24-0696f5be638e" />{: .centered }  

given $u_g, j_n, f$  
the constitutive relation : $ j_n = - K_{ij} u_{,j}$  
find $u(\underset{\sim}{x}, t)$ such that $$
\rho \frac{\partial u}{\partial t} = -j_{i,i} + f \quad \text{in} \quad \Omega \times [0, T]
$$  

B.C.s: $ u = u_g \quad \text{on} \quad \partial\Omega_u \\ -j_i n_i = j_n \quad \text{on} \quad \partial\Omega_j $  
Initial condition: $u(\underset{\sim}{x}, 0) = u_0(\underset{\sim}{x})$  

!! 문제 요약 !!  

온도나 농도를 나타내는 변수 $u$를 $t$와 $\underset{\sim}{x}$ 에 따라 어떻게 변하는지 예측  
$u$: 관심있는 물리량 (온도, 농도)  
$\underset{\sim}{x}$: (x,y,z) 좌표  
$\rho \frac{\partial u}{\partial t}$: 저장/변화 $\rightarrow$ 물리량이 얼마나 저장되는지 나타내는 계수  
$-j_{i,i}$ : 발산, - 기호는 유입된 양을 나타낸다.  
$f$ :  내부에서 생기는 열  

$\underline{\text{Remark}}$ : 열전도에서 $\rho$는 단위부피 당 비열(열용량)을 나타내고 질량 확산에서는 1이다. 그 이유는 단위부피 당 질량이 농도이기 때문이다.  

**Weak form**(infinite- dimensional)  

consider $w \in V = \{ w \mid w=0 \text{ on } \partial\Omega_u \}$  

$$
\int_{\Omega} w \rho \frac{\partial u}{\partial t} \,dV = \int_{\Omega} -w j_{i,i} \,dV + \int_{\Omega} w f \,dV \\
\int_{\Omega} w \rho \frac{\partial u}{\partial t} \,dV = \int_{\Omega} w_{,i} j_i \,dV + \int_{\Omega} w f \,dV - \int_{\partial\Omega} w j_i n_i \,dS
$$  

우변의 첫번째 항을 integrate by part 해주면 디리클레 경계에서는 표면에서 수직방향으로 나가는 양이 0이 되어 노이만 경계 항만 남게 된다.  

$$
\int_{\Omega} w \rho \frac{\partial u}{\partial t} \,dV = \int_{\Omega} w_{,i} \underbrace{j_i}_{=-K_{ij}u_{,j}} \,dV + \int_{\Omega} w f \,dV + \int_{\partial\Omega_j} w j_n \,dS
$$  

RHS에서 음수인 첫번째 항을 좌변으로 옮겨서 식정리를 해주면 최종식은 다음과 같다.  
$$
\int_{\Omega} w \rho \frac{\partial u}{\partial t} \,dV + \int_{\Omega} w_{,i} K_{ij} u_{,j} \,dV = \int_{\Omega} w f \,dV + \int_{\partial\Omega_j} w j_n \,dS
$$  

**Weak form**(finite-dimensional)  

infinite-dimension과 거의 동일.  

$$
\int_{\Omega} w^h \rho \frac{\partial u^h}{\partial t} \,dV + \int_{\Omega} w_{,i}^h K_{ij} u_{,j}^h \,dV = \int_{\Omega} w^h f \,dV + \int_{\partial\Omega_j} w^h j_n \,dS
$$  

위의 식 형태를 보면 steady state와 똑같은 항들하고 시간 term이 추가되어 있다. 따라서 동일한 항들은 steady state와 똑같이 쓰면 되고 시간항만 정리해주면 된다.  

동일한 항:  
$$
\int_{\Omega} w_{,i}^h K_{ij} u_{,j}^h \,dV = \underline{c}^T \underline{K} \underline{d}(t) \quad ; \quad \int_{\Omega} w^h f \,dV + \int_{\partial\Omega_j} w^h j_n \,dS = \underline{c}^T \underline{F}
$$  

다른 항(시간 term 추가):  
$$
\int_{\Omega} w^h \rho \frac{\partial u^h}{\partial t} \,dV
$$  

use $\frac{\partial u^h}{\partial t} \Big|_e = \sum_A N^A \dot{d}_e^A$  
시간에 대해서 미분된 항이 있으니까 자유도를 시간으로 미분한 항으로 계산해주면 된다. 여기서 $\dot{d}_e^A$는 그 노드에서 온도가 시간에 따라 얼마나 빨리 변하는지를 나타낸다.  

$$
\int_{\Omega} w^h \rho \frac{\partial u^h}{\partial t} \,dV = \sum_e \int_{\Omega^e} \left( \sum_A N^A c_e^A \right) \rho \left( \sum_B N^B \dot{d}_e^B \right) \,dV = \sum_e \sum_{A,B} c_e^A \underbrace{\left( \int_{\Omega^e} N^A \rho N^B \,dV \right)}_{M_e^{AB}} \dot{d}_e^B
$$  

$M_e$는 우리가 아는 요소 mass/capacity matrix다.  

use 
$$
\underline{c}_e = \begin{Bmatrix} c_e^1 \\ \vdots \\ c_e^{nne} \end{Bmatrix}, \quad \underline{\dot{d}}_e = \begin{Bmatrix} \dot{d}_e^1 \\ \vdots \\ \dot{d}_e^{nne} \end{Bmatrix}
$$  

시간항을 포함한 항을 정리 해보면  
$$
\Rightarrow \int_{\Omega} w^h \rho \frac{\partial u^h}{\partial t} \,dV = \sum_e \underline{c}_e^T \underbrace{\bar{M}_e}_{\text{element mass matrix}} \underline{\dot{d}}_e
$$

$\underline{\text{Remark}}$  

1 \. 요소들의 범위의 교집합은 없다. 즉, $\partial\Omega^e \cap \partial\Omega_u = \emptyset$  

2\. 벡터 $c_e$의 크기는 $n_{ne}$이다.  

Q. 전에 선형 탄성구조에서는 $n_{ne} x n_{sd}$ 였는데 왜 지금은 $n_{ne}$인가?  
A. 선형 탄성구조에서의 $u$는 변위를 나타내서 벡터여서 x,y,z 방향으로의 변위가 다 달랐다. 하지만 열전도 방정식에서 $u$는 온도를 나타내는 스칼라이기 때문에 방향에 영향이 없다.  

3\. $M_e^{AB} = M_e^{BA}$ 이고 $\underline{\bar{M}}_e = \underline{\bar{M}}_e^T$  

$$
\underline{\bar{M}}_e = 
\begin{bmatrix}
M_e^{11} & \cdots & \cdots & M_e^{1nne} \\
\vdots & \ddots & M_e^{AB} & \vdots \\
\vdots & M_e^{BA} & \ddots & \vdots \\
M_e^{nne1} & \cdots & \cdots & M_e^{nnenne}
\end{bmatrix}
$$  

4\. $underline{\bar{M}}_e$는 positive definite이다. 즉, $$
\underline{c}_e^T \underline{\bar{M}}_e \underline{c}_e \ge 0 \quad \forall \underline{c}_e \in \mathbb{R}^{nne} \\
=0 \quad \text{only if} \quad \underline{c}_e = 0
$$  

5\. 행렬 $M$은 요소의 mass matrix를 포함한다.  

행렬 $M$은 원래 대칭이지만 풀(full)행렬이다. 즉, 한 노드의 dof가 다른 노드의 dof와 연결되어 있다. 그걸 대각행렬로 근사해서 lumped matrix 꼴로 만든다.  

$$
\underline{\tilde{M}}_e = 
\begin{bmatrix}
    \sum_B M_e^{1B} & 0 & \cdots & 0 \\
    0 & \ddots & & \vdots \\
    \vdots & & \ddots & 0 \\
    0 & \cdots & 0 & \sum_B M_e^{nne B}
\end{bmatrix}
$$  

요소 전체에 퍼져 있는 열용량(질량)을 각 노드에 점처럼 덩어리로 나눠서 준다. 계산이 쉬워지고 스칼라 혹산 문제에서 수치적으로 안정하고 깔끔해진다.  

$$
\underline{\hat{M}}_e^{AB} = 
\begin{cases}
    \sum_{C=1}^{nne} M_e^{AC} & \text{if } A=B \\
    0 & \text{otherwise}
\end{cases}
$$  

**경계조건을 적용한 시간 term**  

<img width="291" height="185" alt="image" src="https://github.com/user-attachments/assets/b40ebafc-eb39-4a63-b3e6-8b2a87d51cc5" />{: .centered }  

시간 항: 
$$
\int_{\Omega} w^h \rho \frac{\partial u^h}{\partial t} \,dV = \sum_e \underline{c}_e^T \underline{\bar{M}}_e \underline{\dot{d}}_e = \underline{c}^T \underline{\bar{M}} \underline{\dot{d}}
$$

디리클레 경계조건이 적용된 노드의 $C$벡터는 사라지니까 원래 $C$벡터의 크기는 $n_{ne}$이지만 디리클레 노드를 뺀 $n_{ne} - N_D$로 크기가 조정된다.  

$$
\underline{c} = 
\begin{Bmatrix}
c^1 \\ c^2 \\ c^3 \\ \vdots \\ c^{nne-N_D}
\end{Bmatrix}
; \quad
\underline{\dot{d}} = 
\begin{Bmatrix}
\dot{d}^1 \\ \dot{d}^2 \\ \vdots \\ \dot{d}^{nne}
\end{Bmatrix}
; \quad \text{where} \quad \underline{\bar{M}} = A_e \underline{\bar{M}}_e
$$  

예로 위의 사진처럼 $\Omega^{e_1}$과 $\Omega^{e_2}$에서 서로 공유하는 면 ABCD에 대해서 $M$행렬을 조립해보자.  

$$
\overline{\underline{M}} = 
\begin{bmatrix}
    M_{e_1}^{22} + M_{e_2}^{11} & M_{e_1}^{26} + M_{e_2}^{15} & \cdots & \cdots \\
    M_{e_1}^{62} + M_{e_2}^{51} & \ddots &        & \vdots \\
    \vdots &        & M_{e_1}^{77} + M_{e_2}^{88} & \vdots \\
    \vdots & \cdots & \cdots & \ddots
\end{bmatrix}
$$  

디리클레 경계조건:  
$$
\int_{\Omega} w^h \rho \frac{\partial u^h}{\partial t} \,dV + \int_{\Omega} w_{,i}^h K_{ij} u_{,j}^h \,dV = \int_{\Omega} w^h f \,dV + \int_{\partial\Omega_j} w^h j_n \,dS
$$  

간단하게 써보면  
$$
\underline{c}^T \underline{\bar{M}} \underline{\dot{d}} + \underline{c}^T \underline{\bar{K}} \underbrace{\underline{d}}_{\text{unknown d}} = \underline{c}^T \underbrace{\underline{F}}_{\text{Dirichlet b.c가 적용됨.}}
$$  

좌변에 있는 $d$는 모르는 dof만 디리클레 값을 적용한 아는 값들은 우변으로 넘겨서 F에 포함시켰다.  

$$
\underline{c}^T \overline{\underline{M}} \underline{\dot{d}} = 
\left< c^1, \dots, c^{nne-N_D} \right>
\begin{bmatrix}
\cdots & \overline{\underline{M}}_{\text{col } \bar{A}} & \cdots & \overline{\underline{M}}_{\text{col } \bar{B}} & \cdots
\end{bmatrix}
\begin{Bmatrix}
\dot{d}^1 \\
\vdots \\
\dot{d}^{\bar{A}} \\
\vdots \\
\dot{d}^{\bar{B}} \\
\vdots \\
\dot{d}^{nne}
\end{Bmatrix}
\quad \text{where } \dot{d}^{\bar{A}}, \dot{d}^{\bar{B}} \text{ are known (Dirichlet b.c.s)}
$$  

$\dot{d}^{\bar{A}}$와 $\dot{d}^{\bar{B}}$ 값은 디리클레 경계조건으로 정해진 값이므로 우변으로 넘겨준다.  

$$
\underline{c}^T \underline{M} \underline{\dot{d}} + \underline{c}^T \underline{K} \underline{d} = \underline{c}^T \underbrace{(\underline{F} - \dot{d}^{\bar{A}} \underline{\bar{M}}^{\bar{A}} - \dot{d}^{\bar{B}} \underline{\bar{M}}^{\bar{B}})}_{\text{redefine as } \bar{F}}
$$  

모든 항을 좌변으로 넘겨서 정리하면  

$$
\underline{c}^T (\underline{M} \underline{\dot{d}} + \underline{K} \underline{d} - \underline{F}) = 0 \quad \forall \underline{c} \in \mathbb{R}^{n_{ne}-N_D}
$$  

Semi-discrete matrix-vector problem:  

$$
\underline{M} \underline{\dot{d}} + \underline{K} \underline{d} = \underline{F}
$$  

최종식은 상미분방정식 형태로 나온다. 상미분방정식이란 하나의 독립변수에 대한 그 함수의 도함수를 포함하는 식이다.  

## Time discretization: finite difference method  

이제는 시간을 $\Omega$에 따라서 $[0,T]$으로 적분해준다. 즉 시간을 자른다.  

Divide $[0,T]$ into sub-intervals: $\underbrace{[t_0, t_1], [t_1, t_2], \dots, [t_{N-1}, t_N]}_{N \text{ sub-intervals}}$  

<img width="464" height="76" alt="image" src="https://github.com/user-attachments/assets/38685ae8-a110-4530-b86f-903ef036e5aa" />  

$\underline{d}(t_n)$: $t=t_n$일 때의 진짜 해  
$\underline{d}_n$: 컴퓨터가 계산한 근사해  

참 해:   

$$
\underline{M} \underline{\dot{d}}(t_n) + \underline{K} \underline{d}(t_n) = \underline{F}(t_n)
$$  

근사해:  

$$
\underbrace{\underline{M} \underline{v}_n + \underline{K} \underline{d}_n = \underline{F}_n}_{\text{time-discretized ODE at } t_n}
$$  

$t_{n+1}$에서는 $$
\underline{M} \underline{v}_{n+1} + \underline{K} \underline{d}_{n+1} = \underline{F}_{n+1}
$$  

**Integration algorithm: Euler Family for first-order ODEs**  

$\dot{y} = f(y)$   

알고리즘: $\frac{y_{n+1} - y_n}{\Delta t} = f(y_{n+\alpha})$  
$\Delta t = t_{n+1} - t_n$ (time step)  
$\alpha \in [0, 1]$  

$$
\int_{t_n}^{t_{n+1}} V(t) \,dt \approx \Delta t [\alpha V_{n+1} + (1-\alpha)V_n]
$$  

1\. $\alpha=0$: Forward Euler (시작 값만을 사용)  
2\. $\alpha=1$: Backward Euler (끝 값만을 사용)  
3\. $\alpha= \frac{1}{2}$: Midpoint Rule (평균 사용)  

알고리즘 식을 $y_{n+1}$에 대한 식으로 다시 정리하면 $y_{n+1} = y_n + \Delta t \cdot f(y_{n+\alpha})$  
$y_{n+\alpha} = \alpha y_{n+1} + (1-\alpha) y_n$  

$\frac{y_{n+1} - y_n}{\Delta t}$ : 선형 근사치  
$f(y_{n+\alpha})$: ODE 근사해  

Euler Family를 우리가 마지막으로 구했던 식 $$
\underline{M} \underline{v}_{n+1} + \underline{K} \underline{d}_{n+1} = \underline{F}_{n+1}
$$
에 적용해보자  

$$
\underline{d}_{n+1} = \underline{d}_n + \Delta t \underline{v}_{n+\alpha} \\
\underline{v}_{n+\alpha} = \alpha \underline{v}_{n+1} + (1-\alpha) \underline{v}_n
$$  

**V-method**  

$$
\underline{d}_{n+1} = \underline{d}_n + \Delta t [\alpha \underline{v}_{n+1} + (1-\alpha) \underline{v}_n] =  \underbrace{\underline{d}_n + (1-\alpha) \Delta t \underline{v}_n}_{\underline{\tilde{d}}_{n+1}} + \alpha \Delta t \underline{v}_{n+1}
$$  

첫번째 두번째 항은 $$
\underline{d}_n + (1-\alpha) \Delta t \underline{v}_n}_{\underline{\tilde{d}}_{n+1}
$$ 
예측자이고 
$$
\alpha \Delta t \underline{v}_{n+1}
$$ 
이 부분은 정정자다.  

따라서 Predictor-corrector method 라고 한다.  

$$
\underline{d}_{n+1} = \underline{\tilde{d}}_{n+1} + \alpha \Delta t \underline{v}_{n+1}
$$  

Substitute Predictor-corrector form  

$$
\underline{M} \underline{v}_{n+1} + \underline{K} \underline{d}_{n+1} = \underline{F}_{n+1}
$$ : 원래 식  

$$
\Rightarrow \underline{M} \underline{v}_{n+1} + \underline{K} \underline{\tilde{d}}_{n+1} + \alpha \Delta t \underline{K} \underline{v}_{n+1} = \underline{F}_{n+1}
$$  

$\underline{v}_{n+1}$로 묶어서 식 정리하면  
$$
\Rightarrow (\underline{M} + \alpha \Delta t \underline{K}) \underline{v}_{n+1} = \underline{F}_{n+1} - \underline{K} \underline{\tilde{d}}_{n+1}
$$  

따라서 $\underline{v}_{n+1}$는   
$$
\underline{v}_{n+1} = (\underline{M} + \alpha \Delta t \underline{K})^{-1} (\underline{F}_{n+1} - \underline{K} \underline{\tilde{d}}_{n+1})
$$  

1\. Explicit Method (명시적 방법)  

조건: $\underline{M} = \underline{M}_l \quad \& \quad \alpha=0$ 
(Forward Euler)  
결과: $$
\underline{v}_{n+1} = \underline{M}_l^{-1} (\underline{F}_{n+1} - \underline{K} \underline{\tilde{d}}_{n+1})
$$  

장점: 계산량은 줄어들지만 time step을 작게 가져가야 한다.  

2\. Implicit Method  

조건: $\alpha \neq 0$  
결과: $(M + \alpha \Delta t K)V_{n+1} = F_{n+1} - K(d_n + \Delta t(1 - \alpha)V_n)$  

왼쪽 행렬에 $K$가 들어와서 전역적으로 커플링 되어있다. $n+1$의 미지수들을 풀어야 다음 스텝으로 갈 수 있다.  

장점: 매우 안정적이다.  
단점: 계산량이 많다.































